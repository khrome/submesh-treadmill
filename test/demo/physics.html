<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <link rel="icon" href="/favicon.ico">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Treadmill Demo</title>
        <link rel="stylesheet" href="./style.css">
        <script type="importmap">
            {
                "imports": {
                    "three": "/node_modules/three/build/three.module.js",
                    "marker-engine": "/node_modules/marker-engine/src/index.mjs",
                    "submesh-treadmill": "/submesh-treadmill.mjs",
                    "chai": "/node_modules/chai/chai.js",
                    "sift": "/node_modules/sift/es5m/index.js",
                    "@environment-safe/esm-worker":"/node_modules/@environment-safe/esm-worker/src/index.mjs",
                    "bitwise-logger":"/node_modules/bitwise-logger/bitwise-logger.js",
                    "bitwise-logger/src/console.js":"/node_modules/bitwise-logger/src/console.js",
                    "stats.js": "/node_modules/stats.js/src/Stats.js",
                    "dat.gui": "/node_modules/dat.gui/src/dat/index.js",
                    "three-spritetext": "/node_modules/three-spritetext/dist/three-spritetext.mjs",
                    "bitwise-logger": "/node_modules/bitwise-logger/bitwise-logger.js",
                    "cannon-es": "/node_modules/cannon-es/dist/cannon-es.js",
                    "extended-emitter-es6": "/node_modules/extended-emitter-es6/extended-emitter-es6.js",
                    "three/addons/controls/OrbitControls.js": "/node_modules/three/examples/jsm/controls/OrbitControls.js",
                    "three/addons/geometries/TextGeometry.js":"/node_modules/three/examples/jsm/geometries/TextGeometry.js",
                    "module": "/test/safe-emitter.js",
                    "extended-emitter": "/node_modules/extended-emitter/./extended-emitter.mjs",
                    "browser-or-node": "/node_modules/browser-or-node/src/index.js",
                    "three/examples/jsm/loaders/FBXLoader.js":"/node_modules/three/examples/jsm/loaders/FBXLoader.js",
                    "node:events": "/node_modules/extended-emitter/node-events.mjs"
                }
            }
        </script>
        <style>
            .game-world{
                width: 100vw;
                height: 100vh;
            }
        </style>
    </head>
    <body>
        <div class="game-world"></div>
        <script type="module">
            import { 
                Avatar, 
                Marker, 
                Monster, 
                Projectile, 
                PhysicsProjectile, 
                Scenery
            } from '../../src/default-markers.mjs';
            import { Treadmill } from '../../submesh-treadmill.mjs';
            (async ()=>{
                const treadmill = new Treadmill({
                    voxelFile: '/src/submesh-voxels.mjs',
                    markerTypesFile: '/src/default-markers.mjs',
                    container: '.game-world',
                    debug: true
                });
                await treadmill.preload([Marker, Avatar]);
                const avatar = new Avatar({
                    id : 'player-avatar',
                    meshAttached: true,
                    position:{
                        x: 5,
                        y: 5,
                    },
                    values: {
                        movementSpeed: 5
                    }
                });
                treadmill.addMarker(avatar);
                treadmill.focusOn(avatar);
                treadmill.start();
                treadmill.engine.once('load', ()=>{
                    //console.log('loaded')
                    //setTimeout(()=>{
                        //treadmill.start();
                        /*
                        treadmill.engine.markers.forEach((marker)=>{
                            const position = {
                                x: (Math.random()*48 -16),
                                y: (Math.random()*48 -16),
                                z: 0
                            };
                            const action = 'moveTo';
                            //const action = 'turn';
                            marker.action(action, {}, position);
                        }); //*/
                    //}, 1000);
                });
            })();
        </script>
    </body>
</html>